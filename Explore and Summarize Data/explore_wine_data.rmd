Explore Red Wine Data by Victor Lambert
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(gridExtra)
library(GGally)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
# Load the Data
wd = read.csv("wineQualityReds.csv")
# Update the X column to a factor
wd$X <- factor(wd$X)
```

This dataset contains 1599 records of red wine chemical composition and quality
rating. The wine is the red Vinho Verde out of northern Portugal. There are 12
variables in the dataset, 11 chemical properties of the wine and quality as
reported by three different critics.

Input variables (based on physicochemical tests):
   1 - fixed acidity (tartaric acid - g / dm^3)
   2 - volatile acidity (acetic acid - g / dm^3)
   3 - citric acid (g / dm^3)
   4 - residual sugar (g / dm^3)
   5 - chlorides (sodium chloride - g / dm^3)
   6 - free sulfur dioxide (mg / dm^3)
   7 - total sulfur dioxide (mg / dm^3)
   8 - density (g / cm^3)
   9 - pH
   10 - sulphates (potassium sulphate - g / dm3)
   11 - alcohol (% by volume)
   Output variable (based on sensory data): 
   12 - quality (score between 0 and 10)

Questions we will investigate during this exploration:
- What are the variables that impact wine quality?
- Can we use the data to predict wine quality?
- Are there interesting correlations between other measurments?

# Univariate Plots Section

In this section we look into the distribution of single variables.

### Quality Distribution

```{r echo=FALSE, message=FALSE, warning=FALSE, Quality_Summary}
print('Quality Summary')
summary(wd$quality)
```

It is clear from the max and min that there aren't any wines above 8 or below 3.
Also, since the first and third quantile are 5 and 6 respectively we expect the
majority of the values to fall between 5 and 6. Since it is very discrete a 
table of all the values could be useful.

```{r echo=FALSE, message=FALSE, warning=FALSE, Quality_Table}
print('Quality Table')
table(wd$quality)
```

Here it is clear that we should combine some bins in order to have a better
significance for those areas. We create four bins for wine quality:
- poor wines 3 and 4
- low-mediocre wines 5
- high-mediocre wines 6
- good wines 7 and 8
These bins can be used to split other variables and see if there are patterns.

```{r echo=FALSE, message=FALSE, warning=FALSE, Quality_Bins}
wd$quality.bin  <- cut(wd$quality, c(2, 4, 5, 6, 8))
print("Quality Bins Table")
table(wd$quality.bin)
```

As we expected, most of the values are either 5 or 6 for quality. There are 
quite a few 7 wines also which might be helpful for identifying trends. We will
look at the distribution in a histogram next.

```{r echo=FALSE, message=FALSE, warning=FALSE, Quality_hist}
ggplot(aes(quality), data = wd) + 
  geom_histogram(binwidth = 1) +
  scale_x_continuous(breaks = seq(2,10, 1))
```

Initially, looking at the distribution of quality we see something close to a 
normal distribution. The vast majority of the wines are in the middle of the 
spectrum, and there are not many wines at the extremes. We will try to find any
variables which can help us predict this. 

We will go through the available variables, paying particular attention to ones
which might be of particular interest.

## Acidity Metrics

```{r echo=FALSE, message=FALSE, warning=FALSE, Acidity_Plot}
p <- ggplot(data = wd)
p1 <- p + geom_histogram(aes(fixed.acidity))
p2 <- p + geom_histogram(aes(volatile.acidity))
p3 <- p + geom_histogram(aes(citric.acid))
grid.arrange(p1,p2,p3, ncol = 1)
```

Looking at the three different types of acid, the fixed and volatile acidity are
clearly close to a normal distribution. The citric acid, however doesn't look
like a normal distribution. We will look at the log of the citric acid content.

```{r echo=FALSE, message=FALSE, warning=FALSE, Citric_acid_log}
ggplot(aes(citric.acid), data = wd) +
  geom_histogram(bins = 50) + 
  scale_x_log10()
```

The citric acid content does seem more normal when plotted as a log, but still
not perfect since it is skewed by some low values. For the last acidity related
metric we will look at pH.

```{r echo=FALSE, message=FALSE, warning=FALSE, pH_Hist}
ggplot(aes(pH), data = wd) +
  geom_histogram()

summary(wd$pH)
```

The pH follows a very normal distribution with almost all of the values between
three and four. This likely correlates well with the acidity variables, we will
look into this more in the bi and multi variate analysis section.

### Inorganic Molecule Analysis

Next we move on to analyses of the inorganic compounds reported in the dataset.
First, we investigate the chloride content. 

```{r echo=FALSE, warning=FALSE, message=FALSE, Chloride_plot}
ggplot(aes(chlorides), data = wd) +
  geom_histogram()

summary(wd$chlorides)
```

We see that the majority of chloride concentrations lie between zero and 0.2, 
but there are some values as high as 0.6. The median value is about 0.8 mg/L. We
should zoom in on the are with most of the values to get a better idea of the 
distribution. 

```{r echo=FALSE, message=FALSE, warning=FALSE, chloride_zoom}
ggplot(aes(chlorides), data = wd) +
  geom_histogram() +
  scale_x_continuous(limits = c(0, 0.15))
```

The distribution of chlorides looks much more normal in that region. It seems to
be a normal distribution with a long tail. We will have to check if the long 
tail values influence the quality in the two variable analysis later. Now, the 
sulfur dioxide, both free and total. 

```{r echo=FALSE, message=FALSE, warning=FALSE, sulfur_plot}
freeso2 <- p + geom_histogram(aes(free.sulfur.dioxide))
totalso2 <- p + geom_histogram(aes(total.sulfur.dioxide))

grid.arrange(freeso2, totalso2)
```

The data description states that free SO2 is the type which would impact the 
flavor of the wine, particularly if it is too high. That threshold will have to 
be investigated later in the analysis. Another interesting thing to consider is 
the proportion of free over total sulfur dioxide in each wine. Perhaps that
value will be similar in all wines.

```{r echo=FALSE, message=FALSE, warning=FALSE, sulfur_proportion}
wd$proportion.sulfur.dioxide = wd$free.sulfur.dioxide / wd$total.sulfur.dioxide
ggplot(data = wd) +
  geom_histogram(aes(proportion.sulfur.dioxide))
```

It seems like the proportion varies widely, from .02 to 0.85, with most of the 
values being between 0.25 and 0.4. Now we can print some summary statistics
for sulfur dioxide.

```{r echo=FALSE, warning=FALSE, message=FALSE, SO2_stats}
print("Free SO2")
summary(wd$free.sulfur.dioxide)
print("Total SO2")
summary(wd$total.sulfur.dioxide)
print("Proportion Free")
summary(wd$proportion.sulfur.dioxide)
```

We can see that the distributions match nicely with our observations from above.
Now we will look into the sulphate contents of the wines.

```{r echo=FALSE, message=FALSE, warning=FALSE, sulphate_plot}
ggplot(aes(sulphates), data = wd) + 
  geom_histogram()
```

From this histogram it seems that the sulphates follow a similar long tail 
distribution to many of the other salts contained in the wine. We will have to
check later if the higher values have a larger impact on quality.

### Bulk Property Analysis

Now, we will move on to the analysis of some bulk properties of the wine 
including sugar content, alcohol content, and density. First, we look at the 
distribution of residual sugar content. This is the amount of sugar remaining
after the fermentation of the wine. 

```{r echo=FALSE, message=FALSE, warning=FALSE, Sugar_Plot}
p5 <- p + geom_histogram(aes(residual.sugar))
p5
```

When looking at the sugar data, we see a simlar pattern to many other wines. 
Most fall within a lower bell curve and there is a long tail of much sweeter
wines. The sugar content of the final wine is usually set by the winemaker, so 
it is possible that most people are targeting a dryer wine in that particular
RS region. We can split the data across different quality bins to see if we can
find a pattern.

```{r echo=FALSE, message=FALSE, warning=FALSE, sugar_split}
p5 + facet_wrap(~quality.bin, scales = 'free') +
  scale_x_continuous(limits = c(0, 16))
```

There is not apparent a trend with sugar content and quality in the different
groups of wines. Next we look at the distribution of alcohol contents.

```{r echo=FALSE, message=FALSE, warning=FALSE, Alcohol_Plot}
ggplot(aes(alcohol), data = wd) +
  geom_histogram(bins = 60)
```

Unlike the sugar content and many other variables, the alcohol content does not
follow the long tail distribution. It seems that the alcohol distribution has a 
many more values in the long tail. This could be a result of the differing 
ripeness of grapes at harvest. If they are targeting a particular residual sugar
value, the alcohol content will be primarily constrained by the initial sugar
content of the grapes. We can split the alcohol content along different
quality groupings as well.

```{r echo=FALSE, message=FALSE, warning=FALSE, Alcohol_Split}
ggplot(aes(alcohol), data = wd) +
  geom_histogram() +
  facet_wrap(~quality.bin, scales = 'free') +
  scale_x_continuous(limits = c(8, 15))
```

Split over the four quality bins, it is clear that higher alcohol seems to
correlate with better quality. We will have to investigate this relationship
further. The alcohol is not necessarily the cause of the improvement, it could
be that riper grapes or some other variable improve quality and higher alcohol
is a byproduct of those. The final variable for us to investigate is density.

```{r echo=FALSE, message=FALSE, warning=FALSE, Density_Plot}
ggplot(aes(density), data = wd) +
  geom_histogram()
```

The density follows a very normal distribution, it should be closely related 
with alcohol and sugar content.

# Univariate Analysis

We are able to draw some useful information from looking at the single variable
analysis. We can see that the alcohol content likely correlates with better 
quality in the wine.

### What is the structure of your dataset?

The data contains 12 variables, 11 of which are floating point numbers and one
is an integer. It also contains an id, called 'X' which has been converted to 
a factor to prevent numerical analysis. The data already is tidy and does not
have missing values or many other issues.

### What is/are the main feature(s) of interest in your dataset?

The dataset consists of one important metric, the quality of the wine, and 11
other chemical variables about the wine. The main feature of interest is how
we can predict the quality of the wine from some combination of these other
chemicals.

### What other features in the dataset do you think will help support your 
investigation into your feature(s) of interest?

The dataset contains many interrelated variables, we will also look to see how
these variables vary together to supplement the quality based analysis.

### Did you create any new variables from existing variables in the dataset?

Yes, two new variables were created. The first, quality.bin groups the 3 and 4 
values together, and the 7 and 8 values together. This is to increase the
number of wines in the high quality and low quality bins for the purpose of 
data splitting. The second created variable is the proportion of SO2 that is 
free, which didn't prove to be particularly helpful yet.

### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?

There were many variables which had long tail distributions, although that was
the most unusual thing found so far. No further tidying or adjustment has been
done on the data. Now, we will move on to analysis of two variables.

# Bivariate Plots Section

First, we can take a look at a ggpairs plot to see if there are any unexpected
relationships that we should investigate later. The plot shows correlations
on the upper half, frequency polygons on the diagonal, and scatter plots on the 
lower diagonal.

```{r echo=FALSE, message=FALSE, warning=FALSE, ggpairs_plot}
ggpairs(wd, columns = seq(2, 13), lower = list(continuous = 'smooth')) +
  theme_grey(base_size = 4)
```

Looking at the ggpairs, we can see some expected relationships and some 
unexpected ones. Several variables have correlations with quality, although none
of the correlations are large. The biggest effect is alcohol with a correlation
of 0.48. The other larger correlations are volatile acidity (-0.39), 
sulphates (0.25) and citric acid (0.22). This makes sense from what we know 
about these acids, citric acidhas a pleasant flavor but acetic (volatile) acid 
does not.

As far as other variables go, we can see that the different acid variables and 
pH are also correlated, although the volatile acididy correlation is the 
opposite of what we would expect since lower pH is more acidic. It also seems 
that acidict has a relationship with density which I did not predict in the
univariate analysis.

Let's take a closer look at how some of these things relate to quality, starting
with alcohol. Note that when plotting with quality as the dependent variable
adding jitter and some transparancy is very helpful to visualize the data.

```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol_scatter}
ggplot(aes(x = alcohol, y = quality), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')
```

Here we an see the relationship that was hinted at in the univariate analysis.
Wines with higher alcohol definitely have a higher quality average. The effect
is not strong, but there are not many better than average wines for us to draw
conclusions from.

```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol_box}
ggplot(aes(x = quality.bin, y = alcohol), data = wd) +
  geom_boxplot(alpha = 1/5)
```

Taking a look at this from a different plot, we can see that the higher quality
wines definitely have a higher value for alcohol. The box plot is nice because
it shows us the median as well as some grouping statistics.

```{r echo=FALSE, message=FALSE, warning=FALSE, citric_scatter}
ggplot(aes(x = citric.acid, y = quality), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(method = 'lm', color = 'black')
```

Looking at the citric acid, we can see that the correlation is small. It seems
that there are more high quality wines with higher citric acid, and more low
quality wines with low citric acid.

```{r echo=FALSE, message=FALSE, warning=FALSE, volatile_scatter}
ggplot(aes(x = volatile.acidity, y = quality), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')
```

For volatile acid, the relatinship is more clear. Having more volatile acid is
detrimental to wine quality. Now let's take a look at the sulphates.

```{r echo=FALSE, message=FALSE, warning=FALSE, sulphiate_scatter}
ggplot(aes(x = sulphates, y = quality), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')
```

I wasn't expecting the sulphates to have a positive relationship. Sulphates can
have a preservative effect, so perhaps they are preserving some of the fresh 
flavor of the wines. Let's take a look at the sulfur dioxide.

```{r echo=FALSE, message=FALSE, warning=FALSE, volatile_scatter}
p6 <- ggplot(aes(x = free.sulfur.dioxide, y = quality), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')

p7 <- ggplot(aes(x = total.sulfur.dioxide, y = quality), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')

grid.arrange(p6, p7, ncol = 2)
```

This result is somewhat unexpected. We do expect sulfur dioxide to impact 
quality, since higher concentrations can give an off smell. However, the data
documentation says that only free sulfur dioxide should impact the smell.
However, it seems like total sulfur dioxide has a much bigger impact on the 
quality rating of the wine. Let's move on toconfirm some relationships that we 
don't expect to have an effect.

```{r echo=FALSE, message=FALSE, warning=FALSE, sugar_scatter}
ggplot(aes(x = residual.sugar, y = quality), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')
```

As we expected from the univariate analysis, sugar content doesn't seem to have
any impact at all on the quality of the wine. Now we can take a look at 
relationships between some other variables.

```{r echo=FALSE, message=FALSE, warning=FALSE, density_sugar}
ggplot(aes(x = residual.sugar, y = density), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')
```

We can see that the density has a positive correlation with sugar, as we would 
expect. However, this doesn't explain all the variation.

```{r echo=FALSE, message=FALSE, warning=FALSE, density_alcohol}
ggplot(aes(x = alcohol, y = density), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')
```

Taking a look at the effect that alcohol has on density, it's clear that the 
lower density of ethanol is decreasing the density of lots of the wines. It's
likely that alcohol and sugar explain much of the density variation for the 
wines, we an look at them all together in the multivariate analysis.

```{r echo=FALSE, message=FALSE, warning=FALSE, pH_fixed_scatter}
p8 <- ggplot(aes(x = pH, y = fixed.acidity), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')

p9 <- ggplot(aes(x = pH, y = volatile.acidity), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')

grid.arrange(p8, p9, ncol = 2)
```

Taking a look at the acidity, we see that fixed acidity has a much higher effect
on pH than volatile acidity. We actually see the opposite effect in volatile
acidity, which is unexpected. Possibly the fixed acidity, which has a much 
larger magnitude is affecting the pH more.

```{r echo=FALSE, message=FALSE, warning=FALSE, volatile_fixed_scatter}
ggplot(aes(x = fixed.acidity, y = volatile.acidity), data = wd) +
  geom_jitter(alpha = 1/5) +
  geom_smooth(color = 'black', method = 'lm')
```

Taking a look at fixed acidity vs volatile acidity, we do see that wines with
more volatile acidity tend to fall lower on the fixed acidity scale. This
probably explains a large portion of the unexpected pH trend.

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

There are several factors which impact the quality rating of the wine. Higher
alcohol content was once again shown to be correlated with a higher quality of
the wine. Some other variables were also associated with better quality, 
including citric acid and sulphate content. The sulphate content was surprising 
to me, but could be a result of it acting as a preservative.

We also saw that volatile acidity and total sulfur dioxide content had a 
negative correlation with quality rating in wine. The effect of total sulfur
dioxide was bigger than the effect of free sulfur dioxide, which was unexpected.

Overall, alcohol is the strongest positive predictor of quality, however there
are not any very strong correlations for the quality rating.

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

I also looked into the relationship between some bulk properties of the wine,
particularly the density. It seems like the alcohol content is a large predictor
of lower density, which follows according to the lower density of ethanol. As a 
side note, as a chemical engineer I know that this relationship is not linear,
though at these concentrations it shouldn't be a big deal. The sugar content 
also has an impact on the density, though not as large as the alcohol content.

pH and the contribution of fixed and volatile acidity were also examined. There
was one surprising result of volatile acidity, but it seems to be explained
by the higher magnitude of the fixed acidity.

### What was the strongest relationship you found?

The strongest correlation I found is the relationship between acidity and pH 
with a correlation of 0.68. Density and alcohol also have a very high 
correlation. The strongest correlation for the primary feature of the data
is the alcohol content, with a correlation of 0.48.

# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!